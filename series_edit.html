<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Document</title>
    <link rel="stylesheet" href="css/bootstrap.css">
    <!--<link rel="stylesheet" href="css/bootstrap-theme.min.css">-->
    <link rel="stylesheet" href="css/styles.css">
    <link rel="stylesheet" href="css/dropdowns-enhancement.css">
    <link rel="stylesheet" href="http://maxcdn.bootstrapcdn.com/font-awesome/4.3.0/css/font-awesome.min.css">
    <!--<script src="//code.jquery.com/jquery-1.11.2.min.js"></script>-->
    <script src="http://code.jquery.com/jquery-1.11.2.min.js"></script>
    <!--<script src="//twitter.github.io/typeahead.js/releases/latest/typeahead.bundle.js"></script>-->
    <script src="https://twitter.github.io/typeahead.js/releases/latest/typeahead.bundle.js"></script>
    <!--<script src="//maxcdn.bootstrapcdn.com/bootstrap/3.3.4/js/bootstrap.min.js"></script>-->
    <script src="http://maxcdn.bootstrapcdn.com/bootstrap/3.3.4/js/bootstrap.min.js"></script>
    <!--<script src="//code.jquery.com/ui/1.11.4/jquery-ui.min.js"></script>-->
    <script src="http://code.jquery.com/ui/1.11.4/jquery-ui.min.js"></script>
    <script src="js/listgroup.js"></script>
    <script src="js/dropdowns-enhancement.js"></script>
    <!-- The Load Image plugin is included for the preview images and image resizing functionality -->
    <script src="http://blueimp.github.io/JavaScript-Load-Image/js/load-image.all.min.js"></script>
    <!-- The Canvas to Blob plugin is included for image resizing functionality -->
    <script src="http://blueimp.github.io/JavaScript-Canvas-to-Blob/js/canvas-to-blob.min.js"></script>
    <!-- The Iframe Transport is required for browsers without support for XHR file uploads -->
    <script src="js/jquery.iframe-transport.js"></script>
    <!-- The basic File Upload plugin -->
    <script src="js/jquery.fileupload.js"></script>
    <!-- The File Upload processing plugin -->
    <script src="js/jquery.fileupload-process.js"></script>
    <!-- The File Upload image preview & resize plugin -->
    <script src="js/jquery.fileupload-image.js"></script>
    <script src="js/jquery.resizableColumns.min.js"></script>
    <script src="js/ellipses-left.js"></script>
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <style>
    input[type="checkbox"] {
        margin: -6px 0px 0px;
        line-height: normal;
        width: 13px;
    }
    </style>
</head>
<body>
<div class="modal fade" id="loginModal" tabindex="-1" role="dialog" aria-labelledby="loginModalLabel" aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal" aria-label="Закрыть"><span aria-hidden="true">&times;</span></button>
        <h4 class="modal-title" id="loginModalLabel">Вход</h4>
      </div>
      <div class="modal-body">
                <form class="form-horizontal">
          <div class="form-group">
            <label for="inputLoginModal" class="col-sm-2 control-label">Логин</label>
            <div class="col-sm-10">
              <input type="email" class="form-control" id="inputLoginModal" placeholder="Логин">
            </div>
          </div>
          <div class="form-group">
            <label for="inputPasswordModal" class="col-sm-2 control-label">Пароль</label>
            <div class="col-sm-10">
              <input type="password" class="form-control" id="inputPasswordModal" placeholder="Пароль">
            </div>
          </div>
          <div class="form-group">
            <div class="col-sm-offset-2 col-sm-10">
              <div class="checkbox">
                <label>
                  <input type="checkbox"> Запомнить пароль
                </label>
              </div>
            </div>
          </div>
          <div class="form-group">
            <div class="col-sm-offset-2 col-sm-10">
              <button type="submit" class="btn btn-primary">Вход</button>
            </div>
          </div>
        </form>
      </div>
    </div>
  </div>
</div>
<div class="modal-backdrop" style="display:none"></div>
<nav class="navbar navbar-default navbar-top navbar-static-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="#"><img alt="RuRanobe" src="img/logo1.png"></a>
    </div>
    <div class="collapse navbar-collapse">
      <div class="secondLogoContainer"><div class="secondLogo"></div></div>
      <form class="navbar-form navbar-right">
            <button class="btn btn-white">Регистрация</button>
            <button class="btn btn-outline" data-toggle="modal" data-target="#loginModal">Вход</button>
      </form>
    </div>
  </div><!-- /.container -->
</nav>
<nav class="navbar navbar-default navbar-lower" role="navigation">
  <div class="container">
    <div class="collapse navbar-collapse collapse-buttons" id="bs-example-navbar-collapse-1">
      <form class="navbar-form visible-xs-block">
            <button class="btn btn-default">Регистрация</button>
            <button class="btn btn-primary" data-toggle="modal" data-target="#loginModal">Вход</button>
      </form>
      <ul class="nav navbar-nav">
            <li><a href="#">Обновления</a></li>
            <li><a href="#">Проекты</a></li>
            <li><a href="#">Набор в команду</a></li>
            <li><a href="#">FAQ</a></li>
            <li><a href="#">О нас</a></li>
            <li><a href="#">Связь</a></li>
      </ul>
      <form class="navbar-form navbar-right">
            <a href="#" class="btn btn-danger">Трансляции</a>
            <a href="https://vk.com/ru.ranobe" class="btn btn-primary"><i class="fa fa-vk"></i></a>
            <a href="#" class="btn btn-primary"><i class="fa fa-rss"></i></a>
      </form>
    </div>
  </div>
</nav>
<div class="container">
        <div class="leftColumn">
            <main class="content">
                <h2>Главы</h2>
                <form>
                <div class="row">
                    <div class="col-xs-4">
                        <div class="btn-group" role="group" aria-label="Панель глав">
                          <button type="button" class="btn btn-success" title="Добавить новую главу" id="btn-series-add"><i class="fa fa-plus"></i></button>
                          <button type="button" class="btn btn-danger" title="Удалить главу" id="btn-series-delete" disabled><i class="fa fa-trash-o"></i></button>
                        </div>
                        <div class="list-group select sortable" id="seriesselect" style="margin-top:10px">
                            <a data-toggle="collapse" data-parent="#seriesform" href="#series1" aria-expanded="true" aria-controls="series1" class="list-group-item" >
                                <i class="fa fa-ellipsis-v move"></i>
                                <span class="hidden-sm hidden-xs"  id="series1_name">Серия 1</span>
                            </a>
                            <a data-toggle="collapse" data-parent="#seriesform" href="#series2" aria-expanded="true" aria-controls="series2" class="list-group-item" >
                                <i class="fa fa-ellipsis-v move"></i>
                                <span class="hidden-sm hidden-xs"  id="series2_name">Серия 2</span>
                            </a>
                            <a data-toggle="collapse" data-parent="#seriesform" href="#series3" aria-expanded="true" aria-controls="series3" class="list-group-item" >
                                <i class="fa fa-ellipsis-v move"></i>
                                <span class="hidden-sm hidden-xs"  id="series3_name">Серия 3</span>
                            </a>
                            <a data-toggle="collapse" data-parent="#seriesform" href="#series4" aria-expanded="true" aria-controls="series4" class="list-group-item" >
                                <i class="fa fa-ellipsis-v move"></i>
                                <span class="hidden-sm hidden-xs"  id="series4_name">Серия 4</span>
                            </a>
                        </div>
                    </div>
                    <div class="col-xs-8 admin-affix" id="seriesform" role="tablist" aria-multiselectable="true">
                        <div class="progress collapse">
                            <div class="progress-bar progress-bar-striped active" role="progressbar" aria-valuenow="0" aria-valuemin="0" aria-valuemax="100" style="width: 0%">
                                <span class="sr-only">0% Complete</span>
                            </div>
                        </div>
                        <div  class="panel">
                            <div class="row collapse series-data" role="tabpanel" id="series1">
                                <input type="hidden" id="series1_id">
                                <input type="hidden" id="series1_order">
                                <input type="hidden" id="series1_delete">
                                <div class="series-data-main">
                                    <h3>Настройка серии</h3>
                                    <div class="form-group">
                                        <label for="series1_url">Ссылка</label>
                                        <input class="form-control url-input" type="text" id="series1_url_input">
                                        <label for="series1_name">Заголовок</label>
                                        <input class="form-control name-input" type="text" id="series1_name_input" value="Начальные иллюстрации">
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="panel">
                            <div class="row collapse series-data" role="tabpanel" id="series2">
                                <input type="hidden" id="series2_id">
                                <input type="hidden" id="series2_order">
                                <input type="hidden" id="series2_delete">
                                <div class="series-data-main">
                                    <h3>Настройка серии</h3>
                                    <div class="form-group">
                                        <label for="series2_url">Ссылка</label>
                                        <input class="form-control url-input" type="text" id="series2_url_input">
                                        <label for="series2_name">Заголовок</label>
                                        <input class="form-control name-input" type="text" id="series2_name_input" value="Пролог">
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="panel">
                            <div class="row collapse series-data" role="tabpanel" id="series3">
                                <input type="hidden" id="series3_id">
                                <input type="hidden" id="series3_order">
                                <input type="hidden" id="series3_delete">
                                <div class="series-data-main">
                                    <h3>Настройка серии</h3>
                                    <div class="form-group">
                                        <label for="series3_url">Ссылка</label>
                                        <input class="form-control url-input" type="text" id="series3_url_input">
                                        <label for="series3_name">Заголовок</label>
                                        <input class="form-control name-input" type="text" id="series3_name_input" value="Глава 1">
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="panel">
                            <div class="row collapse series-data" role="tabpanel" id="series4">
                                <input type="hidden" id="series4_id">
                                <input type="hidden" id="series4_order">
                                <input type="hidden" id="series4_delete">
                                <div class="series-data-main">
                                    <h3>Настройка серии</h3>
                                    <div class="form-group">
                                        <label for="series4_url">Ссылка</label>
                                        <input class="form-control url-input" type="text" id="series4_url_input">
                                        <label for="series4_name">Заголовок</label>
                                        <input class="form-control name-input" type="text" id="series4_name_input" value="Глава 2">
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                    <button type="submit" class="btn btn-primary btn-lg">Submit</button>
                </form>
            </main>
        </div>

        <aside class="right-sidebar">
            <div class="module projects-module">
                <div class="module_name opened">
                    <i class="fa fa-chevron-down pull-left"></i>
                    <div class="h4">Проекты</div>
                </div>
                <div class="actions banners">
                    <a href="/r/sao" title="Sword Art Online"><img alt="Sword Art Online" src="http://ruranobe.ru/w/images/5/5a/sidebanner-sao.png" height="73" width="220"></a>
                    <a href="/r/mknr" title="Непутевый ученик в школе магии"><img alt="Непутевый ученик в школе магии" src="http://ruranobe.ru/w/images/2/2b/sidebanner-mknr.png" height="73" width="220"></a>
                    <a href="/r/drrr" title="Durarara!!"><img alt="Durarara!!" src="http://ruranobe.ru/w/images/6/6b/sidebanner-drrr.png" height="73" width="220"></a>
                    <a href="/r/aw" title="Accel World"><img alt="Accel World" src="http://ruranobe.ru/w/images/6/6b/sidebanner-aw.png" height="73" width="220"></a>
                    <a href="/r/ho" title="Heavy Object"><img alt="Heavy Object" src="http://ruranobe.ru/w/images/1/12/sidebanner-ho.png" height="73" width="220"></a>
                    <a href="/r/onc" title="Owari no Chronicle"><img alt="Owari no Chronicle" src="http://ruranobe.ru/w/images/2/22/sidebanner-onc.png" height="73" width="220"></a>
                    <a href="/r/hnc" title="Чайка − принцесса с гробом"><img alt="Чайка − принцесса с гробом" src="http://ruranobe.ru/w/images/e/e0/sidebanner-hnc.png" height="73" width="220"></a>
                    <a href="/r/mtikk" title="Проблемные дети приходят из другого мира, верно?"><img alt="Проблемные дети приходят из другого мира, верно?" src="http://ruranobe.ru/w/images/7/7d/sidebanner-mtikk.png" height="73" width="220"></a>
                    <a href="/r/ems" title="Эроманга-сэнсэй"><img alt="Эроманга-сэнсэй" src="http://ruranobe.ru/w/images/0/07/sidebanner-ems.png" height="73" width="220"></a>
                    <a href="/r/oregairu" title="Моя юношеская романтическая комедия оказалась неправильной, как я и предполагал"><img alt="Моя юношеская романтическая комедия оказалась неправильной, как я и предполагал" src="http://ruranobe.ru/w/images/6/64/sidebanner-oregairu.png" height="73" width="220"></a>
                    <a href="/r/trdr" title="ToraDora!"><img alt="ToraDora!" src="http://ruranobe.ru/w/images/1/15/sidebanner-trdr.png" height="73" width="220"></a>
                    <a href="/r/mnotv" title="Madan no Ou to Vanadis"><img alt="Madan no Ou to Vanadis" src="http://ruranobe.ru/w/images/b/b9/sidebanner-mnotv.png" height="73" width="220"></a>
                    <a href="/r/ssnts" title="Дуэлянт странствующей богини"><img alt="Дуэлянт странствующей богини" src="http://ruranobe.ru/w/images/1/12/sidebanner-ssnts.png" height="73" width="220"></a>
                    <a href="/r/lh" title="Log Horizon"><img alt="Log Horizon" src="http://ruranobe.ru/w/images/f/f5/sidebanner-lh.png" height="73" width="220"></a>
                    <a href="/r/mdn" title="Пусть твоя душа упокоится в Магдале"><img alt="Пусть твоя душа упокоится в Магдале" src="http://ruranobe.ru/w/images/3/30/sidebanner-mdn.png" height="73" width="220"></a>
                    <a href="/r/tnynn" title="Становление Героя Щита"><img alt="Становление Героя Щита" src="http://ruranobe.ru/w/images/1/19/sidebanner-tnynn.png" height="73" width="220"></a>
                    <a href="/r/snpnk" title="Кошечка из Сакурасо"><img alt="Кошечка из Сакурасо" src="http://ruranobe.ru/w/images/1/18/sidebanner-snpnk.png" height="73" width="220"></a>
                    <a href="/r/ol" title="Overlord"><img alt="Overlord" src="http://ruranobe.ru/w/images/a/a6/sidebanner-ol.png" height="73" width="220"></a>
                    <a href="/r/ngnl" title="No Game No Life"><img alt="No Game No Life" src="http://ruranobe.ru/w/images/4/42/sidebanner-ngnl.png" height="73" width="220"></a>
                    <a href="/r/tr" title="Tokyo Ravens"><img alt="Tokyo Ravens" src="http://ruranobe.ru/w/images/f/fb/sidebanner-tr.png" height="73" width="220"></a>
                    <a href="/r/tmni" title="Некий Магический Индекс"><img alt="Некий Магический Индекс" src="http://ruranobe.ru/w/images/8/88/sidebanner-tmni.png" height="73" width="220"></a>
                    <a href="/r/haruhi" title="Серия Харухи Судзумии"><img alt="Серия Харухи Судзумии" src="http://ruranobe.ru/w/images/4/4f/sidebanner-haruhi.png" height="73" width="220"></a>
                    <a href="/r/saw" title="Волчица и пряности"><img alt="Волчица и пряности" src="http://ruranobe.ru/w/images/9/9e/sidebanner-saw.png" height="73" width="220"></a>
                    <a href="/r/ch2b" title="Чудачества любви не помеха!"><img alt="Чудачества любви не помеха!" src="http://ruranobe.ru/w/images/1/1a/sidebanner-ch2b.png" height="73" width="220"></a>
                    <a href="/r/aynik" title="All You Need Is Kill"><img alt="All You Need Is Kill" src="http://ruranobe.ru/w/images/b/ba/sidebanner-aynik.png" height="73" width="220"></a>
                    <a href="/r/tnd" title="Наше путешествие на край исчезающего мира"><img alt="Наше путешествие на край исчезающего мира" src="http://ruranobe.ru/w/images/2/26/sidebanner-tnd.png" height="73" width="220"></a>
                    <a href="/r/sd" title="Sugar Dark"><img alt="Sugar Dark" src="http://ruranobe.ru/w/images/3/33/sidebanner-sd.png" height="73" width="220"></a>
                    <a href="/r/inkid" title="Безжизненный мир"><img alt="Безжизненный мир" src="http://ruranobe.ru/w/images/7/74/sidebanner-inkid.png" height="73" width="220"></a><a href="/r/ff7" title="Final Fantasy VII"><img alt="Final Fantasy VII" src="http://ruranobe.ru/w/images/4/42/sidebanner-ff7.png" height="73" width="220"></a>
                </div>
            </div>
        </aside>
</div><div class="container">
    <footer>
        <div class="footer">
            <a href="#">Обновления</a>
            <a href="#">Проекты</a>
            <a href="#">Набор в команду</a>
            <a href="#">FAQ</a>
            <a href="#">О нас</a>
            <a href="#">Помощь</a>
            <a href="#">Связь</a>
        </div>
        <div class="copyright text-center">&copy; Проект <span class="bold">&laquo;РуРанобэ&raquo; </span>2015</div>
    </footer>
</div>

</body>
<script type="text/javascript">
/*
    $(function(){
        $(".volumetable table").resizableColumns();
    });
*/
    $('.list-group.select.sortable').sortable({ // включаем jquery-ui sortable
        items: "a:not(:first-child.heading)", // запрещаем передвигать что либо выше первого heading (не может быть картинок вне глав)
        handle:'.move' // задаем маркер перетягивания
    });


    var j= $('.list-group-item').length; // id каждого элемента в пункте "Главы"

    $('#btn-series-add').click(function(){ // обработка кнопки добавления новой серии
        j++;
        var newSeries = '<a data-toggle="collapse" data-parent="#seriesform" href="#series' + j + '" aria-expanded="true" aria-controls="series' + j + '" class="list-group-item" >'+
        '<i class="fa fa-ellipsis-v move"></i>'+
        '<span class="hidden-sm hidden-xs"  id="series' + j + '_name">Серия ' + j + '</span>'+
        '</a>';
        var newPanel = '<div class="panel">'+
        '<div class="row collapse series-data" role="tabpanel" id="series' + j + '">'+
        '<input type="hidden" id="series' + j + '_id">'+
        '<input type="hidden" id="series' + j + '_order">'+
        '<input type="hidden" id="series' + j + '_delete">'+
        '<div class="series-data-main">'+
        '<h3>Настройка серии</h3>'+
        '<div class="form-group">'+
        '<label for="series' + j + '_url">Ссылка</label>'+
        '<input class="form-control url-input" type="text" id="series' + j + '_url_input">'+
        '<label for="series' + j + '_name">Заголовок</label>'+
        '<input class="form-control name-input" type="text" id="series' + j + '_name_input" value="Серия ' + j + '">'+
        '</div>'+
        '</div>'+
        '</div>'+
        '</div>';
        var newChapterHeading = '<a class="list-group-item heading" data-chapter-id="' + j + '"><span class="move">Серия ' + j + '</span></a>';
        if (!($('#seriesselect').children('.active').attr('href'))) { // если не выбранно ни одного элемента
                    $('#seriesselect').append(newSeries);
                    $('#seriesform').append(newPanel);
                    $('#imageselect').append(newSeriesHeading); // то вставляем новые серии, панели для глав, heading'и в конец
        } else {                                         // иначе
                    $('#seriesselect').children('.active').after(newSeries);
                    $('#seriesform').children('.panel').each(function(){
                        if ($(this).children().hasClass('in')) $(this).after(newPanel); // вставляем после выбранного элемента
                    });
                    var isRightSeries = false; // переменная поиска
                    var imageAfterSeries; // переменная для картинки
                    var id = $('.series-data.in').attr('id'); // id выбранного элемента
                    id = id.substring(7); // берем оттуда только цифру
                    $('#imageselect').children().each(function(){ // в случае с heading мы будеми проверять его на наличие картинок под ним
                        if(($(this).is('.heading[data-series-id]')) && ($(this).attr('data-series-id') == id*1)) {
                            isRightSeries = true; // если это нужный нам heading, то начинаем искать
                        } else if (($(this).attr('data-parent') == '#imageform') && (isRightSeries)) {
                            imageAfterSeries = $(this); // пихаем последнюю картинку что нашли в переменную
                        } else {
                            isRightSeries = false; // перестаем искать, как только натыкаемся на другой heading
                        }
                    });
                    if (imageAfterSeries) { // если мы отыскали какую-либо картинку под выбранной главой
                        imageAfterSeries.after(newSeriesHeading); // то вставляем после нее
                    } else {
                        $('.heading[data-series-id="' + id + '"]').after(newSeriesHeading); // иначе втавляем после выбранного heading
                    }
        }
        $('#series' + j + '_name').css({'margin': '0px 0px 0px 3px'}); // отступ для вновь созданого элемента, дабы он выглядел как все
        var p_order = 0; // поставим для каждой серии порядковый номер
        $(this).children().each(function(){ // проверяем каждый элемент
            $($(this).attr('href')+'_order').val(++p_order); // обновляем порядок
                console.log($(this).attr('href')); // на всякий случай пока оставлю
                console.log(p_order);
        });
        OptionsForSelect = '<option>Весь том</option>'; // Начинаем строить селект
        u = 0;
        $('#seriesselect').children('a').each(function(){
                    u++;
                    OptionsForSelect = OptionsForSelect + '<option id="select_series' + u + '">' + $(this).children('span').text() + ' (' + u + ')</option>';
                });
                $('#updateform').children('.panel').find('.update_series').html(OptionsForSelect);
    });


    $('#seriesform').on('keyup', '.name-input', function(){
        var elem = $(this);  // засовываем этот объект в переменную (на всякий случай)
        var id = $('.series-data.in').attr('id'); // получаем id серии
        $('#' + id + '_name').html(elem.val()); // при помощи предыдущего значения вытворяем с именами, что хотим
        id = id.substring(7);
        $('.heading[data-series-id="' + id + '"]').children().html(elem.val());
        $('#select_series' + id).html(elem.val());
//      console.log($('#select_series' + id));
    });
    $('#seriesselect').on('click', 'a.list-group-item', function() { // баг фикс кнопки удаления (line 1185)
            $('.series-data.in').collapse('hide');
            $($(this).attr('href')).collapse('show');
        });

    $('#seriesform').on('hidden.bs.collapse', '.series-data', function () { // обработка активности кнопки удаления
        $('#btn-series-delete').attr('disabled',true);
    }).on('shown.bs.collapse', '.series-data', function() {
        $('#btn-series-delete').attr('disabled',false);
    });

    $('#btn-series-delete').on('click',function(){ // обработка кнопки удаления для глав
        var id = $('.series-data.in').attr('id');
        var nextSeries = $('#seriesselect [href="#'+id+'"]').next();
        var nextPanel = $(nextSeries.attr('href'));
        $('.series-data.in').collapse('hide');
        $('.series-data.in').parent().hide();
        $('#'+id+'_delete').val(true);
        $('#seriesselect [href="#'+id+'"]').detach();
        id = id.substring(7);
        $('.heading[data-series-id="'+id+'"]').detach();
        if (nextSeries.attr('class') && nextPanel.attr('class')) {
                    nextSeries.addClass('active');
                    nextPanel.collapse('toggle');
        } else {
                    $('#seriesselect').children().last().addClass('active');
                    $($('#seriesselect').children().last().attr('href')).collapse('toggle');
        }
    });

</script>
<script src="js/page.all.js"></script>
</html>